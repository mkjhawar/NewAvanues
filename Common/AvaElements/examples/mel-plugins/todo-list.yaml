# todo-list.yaml
# A todo list plugin demonstrating array manipulation and filtering
# Tier: logic (filtering and array operations)
#
# Features:
# - Add/remove/toggle todo items
# - Filter by all/active/completed
# - Clear completed items
# - Item counter

plugin:
  id: "com.augmentalis.todolist"
  name: "Todo List"
  version: "1.0.0"
  description: "A todo list plugin with filtering"
  tier: logic

state:
  items: []              # Array of { id, text, completed }
  newItemText: ""        # Input field value
  filter: "all"          # all | active | completed
  nextId: 1              # Auto-increment ID

reducers:
  # Update new item text field
  updateNewItemText:
    params: [text]
    next_state:
      newItemText: $text

  # Add new item to the list
  addItem:
    next_state:
      items: $array.append(
        $state.items,
        $object.create(
          "id", $state.nextId,
          "text", $state.newItemText,
          "completed", false
        )
      )
      newItemText: ""
      nextId: $math.add($state.nextId, 1)

  # Remove item by ID
  removeItem:
    params: [id]
    next_state:
      items: $array.filter(
        $state.items,
        "item",
        $logic.not($logic.equals($object.get($item, "id"), $id))
      )

  # Toggle item completed status
  toggleItem:
    params: [id]
    next_state:
      items: $array.map(
        $state.items,
        "item",
        $logic.if(
          $logic.equals($object.get($item, "id"), $id),
          $object.set($item, "completed", $logic.not($object.get($item, "completed"))),
          $item
        )
      )

  # Set filter
  setFilter:
    params: [filter]
    next_state:
      filter: $filter

  # Clear all completed items
  clearCompleted:
    next_state:
      items: $array.filter(
        $state.items,
        "item",
        $logic.not($object.get($item, "completed"))
      )

ui:
  Column:
    style:
      padding: 16
      gap: 16
    children:
      # Header
      - Text:
          value: "My Tasks"
          style:
            fontSize: 32
            fontWeight: "bold"

      # Input section
      - Row:
          style:
            gap: 8
          children:
            - TextField:
                value: $state.newItemText
                placeholder: "What needs to be done?"
                onChange: "updateNewItemText"
                style:
                  flex: 1
            - Button:
                label: "Add"
                onTap: "addItem"
                variant: "primary"
                disabled: $logic.equals($string.length($state.newItemText), 0)

      - Divider: {}

      # Filter tabs
      - Row:
          style:
            gap: 8
            justifyContent: "center"
          children:
            - Button:
                label: "All"
                onTap: "setFilter('all')"
                variant: $logic.if($logic.equals($state.filter, "all"), "primary", "outline")
                style:
                  flex: 1
            - Button:
                label: "Active"
                onTap: "setFilter('active')"
                variant: $logic.if($logic.equals($state.filter, "active"), "primary", "outline")
                style:
                  flex: 1
            - Button:
                label: "Completed"
                onTap: "setFilter('completed')"
                variant: $logic.if($logic.equals($state.filter, "completed"), "primary", "outline")
                style:
                  flex: 1

      # Todo items (filtered)
      - Column:
          style:
            gap: 8
          children:
            # This will be dynamically generated based on filtered items
            # For now showing structure
            - ForEach:
                data: $array.filter(
                  $state.items,
                  "item",
                  $logic.if(
                    $logic.equals($state.filter, "all"),
                    true,
                    $logic.if(
                      $logic.equals($state.filter, "active"),
                      $logic.not($object.get($item, "completed")),
                      $object.get($item, "completed")
                    )
                  )
                )
                itemKey: "id"
                template:
                  Row:
                    style:
                      padding: 12
                      backgroundColor: "#f9f9f9"
                      borderRadius: 8
                      gap: 12
                      alignItems: "center"
                    children:
                      - Checkbox:
                          checked: $object.get($item, "completed")
                          onToggle: "toggleItem($object.get($item, 'id'))"
                      - Text:
                          value: $object.get($item, "text")
                          style:
                            flex: 1
                            textDecoration: $logic.if(
                              $object.get($item, "completed"),
                              "line-through",
                              "none"
                            )
                            color: $logic.if(
                              $object.get($item, "completed"),
                              "#999",
                              "#000"
                            )
                      - Button:
                          label: "Ã—"
                          onTap: "removeItem($object.get($item, 'id'))"
                          variant: "ghost"
                          style:
                            fontSize: 20
                            color: "#999"

      - Divider: {}

      # Footer stats
      - Row:
          style:
            justifyContent: "space-between"
            alignItems: "center"
          children:
            - Text:
                value: $string.concat(
                  $string.concat("", $array.length($array.filter($state.items, "item", $logic.not($object.get($item, "completed"))))),
                  " items left"
                )
                style:
                  fontSize: 14
                  color: "#666"
            - Button:
                label: "Clear completed"
                onTap: "clearCompleted"
                variant: "ghost"
                style:
                  fontSize: 14
