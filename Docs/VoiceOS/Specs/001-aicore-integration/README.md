# Feature 001: AI-Powered Voice Command Intelligence

**Status**: Ready for Implementation
**Created**: 2025-10-26 15:39:24 PDT
**Owner**: Manoj Jhawar (manoj@ideahq.net)
**Implementation Agent**: g3 (or assigned developer)

---

## üìÅ Files in This Spec

| File | Purpose | Status |
|------|---------|--------|
| `README.md` | This file - overview and quick links | ‚úÖ Complete |
| `spec.md` | Complete feature specification (WHAT to build) | ‚úÖ Complete |
| `HANDOFF-INSTRUCTIONS.md` | Step-by-step implementation guide (HOW to execute) | ‚úÖ Complete |
| `plan.md` | Implementation plan (generated by `/idea.plan`) | ‚è≥ Pending |
| `research.md` | Technical research findings (generated by `/idea.plan`) | ‚è≥ Pending |
| `data-model.md` | Entity definitions and data flow (generated by `/idea.plan`) | ‚è≥ Pending |
| `quickstart.md` | Developer quickstart guide (generated by `/idea.plan`) | ‚è≥ Pending |
| `contracts/` | API interfaces and schemas (generated by `/idea.plan`) | ‚è≥ Pending |
| `tasks.md` | Actionable task breakdown (generated by `/idea.tasks`) | ‚è≥ Pending |
| `clarifications.md` | Spec clarifications Q&A (generated by `/idea.clarify`) | üî≤ Optional |
| `compliance-report.md` | Verification report (generated by `/idea.analyze`) | üî≤ Post-implementation |
| `validation-checklist.md` | Final testing checklist (generated by `/idea.checklist`) | üî≤ Post-implementation |

---

## üéØ Quick Summary

**Problem**: VOS4 voice command recognition is limited to simple fuzzy string matching (Levenshtein distance), failing on semantic variations, natural language, and complex multi-step commands.

**Solution**: Integrate hybrid AI/NLP pipeline with three tiers:
1. **Tier 1 (Fast)**: Levenshtein + ONNX sentence embeddings (30-50ms)
2. **Tier 2 (Smart)**: On-device LLM with llama.cpp + Gemma 2B (200-500ms)
3. **Tier 3 (Fallback)**: Google Gemini Flash cloud API (500-1000ms)

**Impact**: Command recognition accuracy increases from ~60% to ~95%+ while processing 95% of commands on-device (privacy-first).

---

## üöÄ Quick Start (For Implementation Agent)

### If you're g3 (or assigned developer):

1. **Read the handoff instructions first**:
   ```bash
   cat /Volumes/M Drive/Coding/vos4/specs/001-aicore-integration/HANDOFF-INSTRUCTIONS.md
   ```

2. **Read the complete specification**:
   ```bash
   cat /Volumes/M Drive/Coding/vos4/specs/001-aicore-integration/spec.md
   ```

3. **Navigate to project root**:
   ```bash
   cd /Volumes/M Drive/Coding/vos4
   ```

4. **Run IDEACODE commands in order**:
   ```bash
   # Optional: Clarify any ambiguous requirements
   /idea.clarify

   # Required: Generate implementation plan
   /idea.plan

   # Required: Generate task breakdown
   /idea.tasks

   # Required: Execute implementation with IDE Loop
   /idea.implement

   # Post-implementation: Verify compliance
   /idea.analyze

   # Post-implementation: Generate validation checklist
   /idea.checklist
   ```

5. **Follow the IDE Loop for each task**:
   - **IMPLEMENT**: Write production code
   - **DEFEND**: Write comprehensive tests (80%+ coverage)
   - **EVALUATE**: Verify acceptance criteria met
   - **COMMIT**: Create atomic git commit with docs

---

## üìä Key Requirements

### Must-Haves (P1)

- Semantic command matching with ONNX embeddings
- On-device LLM inference with llama.cpp + Gemma 2B
- Cloud fallback with Gemini Flash API
- 95%+ offline processing (privacy-first)
- <50ms latency for Tier 1 (80th percentile)
- 80%+ test coverage
- Zero memory leaks

### Should-Haves (P2)

- Natural language date parsing ("next friday" ‚Üí 2025-10-31)
- Multi-step command understanding ("add todo and set due date")
- Model download UI with progress and size transparency
- Settings to control cloud fallback, model storage, telemetry

### Nice-to-Haves (P3)

- Context-aware disambiguation ("check the first one")
- Proactive model warm-up
- Personalized confidence thresholds
- Advanced analytics dashboard

---

## üéì Technical Architecture

### New Module: AICore

**Location**: `/Volumes/M Drive/Coding/vos4/modules/libraries/AICore/`

**Dependencies**:
- ONNX Runtime Android 1.17.0 (embeddings)
- llama.cpp (via git submodule)
- Kotlin Coroutines 1.7.3
- Gson 2.10.1
- Google Gemini API 0.3.0 (optional)

**Key Components**:
- `SentenceEmbedder` - ONNX wrapper for semantic similarity
- `LlamaEngine` - JNI bridge to llama.cpp
- `HybridAIRouter` - Three-tier routing logic
- `GeminiClient` - Cloud API client
- `ModelManager` - Download, validate, update models

### Integration Point

**File to Modify**: `VoiceCommandProcessor.kt`

Replace:
```kotlin
SimilarityMatcher.findBestMatch(text, commands)
```

With:
```kotlin
hybridAIRouter.processCommand(text, context)
```

---

## üìà Success Metrics

| Metric | Baseline | Target | Measurement |
|--------|----------|--------|-------------|
| Command Accuracy | 60% | 95%+ | 200-command test suite |
| Semantic Matching | N/A | 85%+ | Semantic variation tests |
| Offline Processing | 0% | 95%+ | Tier usage telemetry |
| Tier 1 Latency | 10ms | <50ms (p80) | Performance profiler |
| Tier 2 Latency | N/A | <500ms (p80) | Performance profiler |
| Test Coverage | N/A | 80%+ | JaCoCo report |
| Memory Overhead | N/A | <100MB | Android Profiler |

---

## üîó Related Resources

### Documentation
- **Master CLAUDE.md**: `/Volumes/M Drive/Coding/ideacode/claude/CLAUDE.md`
- **IDEACODE Protocols**: `/Volumes/M Drive/Coding/ideacode/protocols/*.md`
- **VOS4 Project Context**: `/Volumes/M Drive/Coding/vos4/Docs/ProjectInstructions/`

### Existing Code to Study
- **VoiceCommandProcessor**: `modules/apps/VoiceOSCore/src/main/java/.../VoiceCommandProcessor.kt`
- **SimilarityMatcher**: `modules/libraries/SpeechRecognition/src/main/java/.../SimilarityMatcher.kt`
- **Whisper Integration** (CMake example): `modules/libraries/SpeechRecognition/src/main/cpp/`

### External Resources
- **ONNX Runtime**: https://onnxruntime.ai/docs/
- **llama.cpp**: https://github.com/ggerganov/llama.cpp
- **Gemini API**: https://ai.google.dev/gemini-api/docs
- **Sentence Transformers**: https://huggingface.co/sentence-transformers

---

## ‚ö†Ô∏è Important Notes

### For Implementation Agent

1. **READ SPEC COMPLETELY** before starting - don't skip to coding
2. **USE IDEACODE WORKFLOW** - follow `/idea.plan` ‚Üí `/idea.tasks` ‚Üí `/idea.implement`
3. **WRITE TESTS FIRST** - Defend phase is mandatory (80%+ coverage)
4. **NO ASSUMPTIONS** - Run `/idea.clarify` if anything is unclear
5. **DOCUMENT CONTINUOUSLY** - Update docs before committing code
6. **STAGE EXPLICITLY** - Only stage files YOU created/modified

### Zero Tolerance Policies

- ‚úÖ ALWAYS use local machine time (`date` command)
- ‚úÖ NEVER delete files without explicit approval
- ‚úÖ ALL code must be 100% functionally equivalent (no regressions)
- ‚úÖ ALL documentation MUST be updated BEFORE commits
- ‚úÖ Stage by category: docs ‚Üí code ‚Üí tests (never mix)
- ‚úÖ NO AI/Claude references in commits
- ‚úÖ Deploy parallel agents for 2+ independent tasks
- ‚úÖ ONLY stage files YOU created/modified (no `git add .`)

---

## üìû Questions?

### For Clarifications
Run `/idea.clarify` to generate targeted questions about underspecified areas.

### For Technical Help
1. Check existing Whisper integration as template
2. Review IDEACODE protocols
3. Study similar code in VOS4 codebase
4. Consult external documentation (linked above)

### For Specification Updates
If you find errors in the spec or need to adjust scope:
1. Document in `specs/001-aicore-integration/changes.md`
2. Get approval before proceeding
3. Update spec.md to reflect changes
4. Update handoff instructions if workflow changes

---

## üéâ When You're Done

After `/idea.implement` completes:

1. Run `/idea.analyze` - verify 100% compliance
2. Run `/idea.checklist` - generate final validation checklist
3. Execute manual testing from checklist
4. Run beta testing with 50+ users
5. Measure success metrics against targets
6. Create pull request with:
   - Link to this spec
   - Summary of changes
   - Test coverage report
   - Performance benchmarks
   - Beta testing results

---

**Created by Manoj Jhawar, manoj@ideahq.net**
**IDEACODE Methodology Version: 1.0.0**
**VOS4 Project**: `/Volumes/M Drive/Coding/vos4`

---

**Status Legend**:
- ‚úÖ Complete
- ‚è≥ Pending (will be generated by commands)
- üî≤ Optional or post-implementation
- ‚ùå Blocked or failed
