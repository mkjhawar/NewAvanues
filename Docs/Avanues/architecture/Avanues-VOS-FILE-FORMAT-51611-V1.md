# VoiceOS Plugin File Format (.vos)

**Version**: 1.0.0
**Created**: 2025-10-27
**Status**: Active

## Overview

The `.vos` file format is the unified file extension for all VoiceOS plugin files, configurations, and layouts. The actual content format (YAML, DSL, Kotlin, JSON) is specified via a type flag in the file header.

## Purpose

- **Unified Extension**: All VoiceOS-related files use `.vos` extension for easy identification
- **Format Flexibility**: Support multiple content formats while maintaining consistent extension
- **Runtime Detection**: Apps can quickly determine file type by reading the header flag
- **App Store Compliance**: Clear distinction between configuration data (Y/D/J) and code (K)

## Type Flags

Every `.vos` file must start with a shebang-style header declaring its type:

```
#!vos:X
```

Where `X` is one of the following type flags:

| Flag | Format | Description | App Store Status | Use Case |
|------|--------|-------------|------------------|----------|
| `Y` | YAML | Structured configuration data | ✅ Allowed | App manifests, configuration files |
| `D` | DSL | Custom DSL syntax | ✅ Allowed | UI layouts, component definitions |
| `K` | Kotlin | Kotlin source code | ⚠️ Pre-compiled | Build-time code generation output |
| `J` | JSON | JSON data format | ✅ Allowed | Data files, API responses |

### App Store Compliance

- **Y, D, J formats**: Pure configuration/data - fully compliant with App Store guidelines
- **K format**: Source code must be pre-compiled into binary before submission
  - Used by AvaCode code generator for development/build time
  - Never distributed as source in production apps

## File Header Format

### Required Header (Line 1)
```
#!vos:Y
```

### Recommended Header (Lines 2-4)
```
#!vos:Y
# VoiceOS Plugin File - YAML Format
# Type Flag: Y = YAML, D = DSL, K = Kotlin, J = JSON
```

### Full Example Header
```
#!vos:D
# VoiceOS Plugin File - DSL Format
# Type Flag: Y = YAML, D = DSL, K = Kotlin, J = JSON
# Created: 2025-10-27
# Description: Main layout for HelloWorld app
```

## Format-Specific Examples

### YAML Format (Y)

**Filename**: `app.vos`

```yaml
#!vos:Y
# VoiceOS Plugin File - YAML Format
# Type Flag: Y = YAML, D = DSL, K = Kotlin, J = JSON

app:
  id: "com.example.myapp"
  name: "My App"
  version: "1.0.0"
  runtime: "AvaUI"
  layout: "layout.vos"

  theme:
    primaryColor: "#007AFF"
    backgroundColor: "#FFFFFF"
```

### DSL Format (D)

**Filename**: `layout.vos`

```dsl
#!vos:D
# VoiceOS Plugin File - DSL Format
# Type Flag: Y = YAML, D = DSL, K = Kotlin, J = JSON

Column {
  uuid: "app/main"
  position: { x: 0, y: 0, z: 0 }

  Button {
    uuid: "app/button1"
    position: { x: 0, y: 0, z: 0 }
    properties: {
      text: "Click Me"
      backgroundColor: "#007AFF"
    }
  }
}
```

### Kotlin Format (K)

**Filename**: `generated.vos`

```kotlin
#!vos:K
// VoiceOS Plugin File - Kotlin Format
// Type Flag: Y = YAML, D = DSL, K = Kotlin, J = JSON
// Generated by AvaCode 1.0.0 on 2025-10-27

package com.example.myapp

import androidx.compose.runtime.Composable
import androidx.compose.material3.Button
import androidx.compose.material3.Text

@Composable
fun GeneratedLayout() {
    Button(onClick = { /* ... */ }) {
        Text("Click Me")
    }
}
```

### JSON Format (J)

**Filename**: `config.vos`

```json
#!vos:J
{
  "_vos_comment": "VoiceOS Plugin File - JSON Format",
  "_vos_type_flags": "Y = YAML, D = DSL, K = Kotlin, J = JSON",
  "plugins": [
    {
      "id": "com.example.plugin1",
      "version": "1.0.0",
      "enabled": true
    }
  ],
  "settings": {
    "debugMode": false,
    "logLevel": "info"
  }
}
```

## Runtime Detection

### Reading Type Flag

**Kotlin Example**:
```kotlin
fun detectVosFileType(file: File): VosFileType {
    val firstLine = file.bufferedReader().use { it.readLine() }

    return when {
        firstLine?.startsWith("#!vos:Y") == true -> VosFileType.YAML
        firstLine?.startsWith("#!vos:D") == true -> VosFileType.DSL
        firstLine?.startsWith("#!vos:K") == true -> VosFileType.KOTLIN
        firstLine?.startsWith("#!vos:J") == true -> VosFileType.JSON
        else -> throw IllegalArgumentException("Invalid .vos file: missing type flag")
    }
}

enum class VosFileType {
    YAML,    // Configuration data
    DSL,     // Layout/UI definitions
    KOTLIN,  // Generated source code
    JSON     // Structured data
}
```

### Processing Based on Type

```kotlin
fun processVosFile(file: File) {
    when (detectVosFileType(file)) {
        VosFileType.YAML -> {
            // Parse YAML starting from line 2
            val yamlContent = file.readLines().drop(1).joinToString("\n")
            val config = YamlParser.parse(yamlContent)
            // Process configuration...
        }

        VosFileType.DSL -> {
            // Parse DSL starting from line 2
            val dslContent = file.readLines().drop(1).joinToString("\n")
            val layout = DslParser.parse(dslContent)
            // Interpret layout...
        }

        VosFileType.KOTLIN -> {
            // Skip header comments and parse Kotlin
            val kotlinCode = file.readLines()
                .dropWhile { it.startsWith("#!") || it.startsWith("//") }
                .joinToString("\n")
            // Process Kotlin source...
        }

        VosFileType.JSON -> {
            // Parse JSON (skip shebang line)
            val jsonContent = file.readLines()
                .dropWhile { it.startsWith("#!") }
                .joinToString("\n")
            val data = JsonParser.parse(jsonContent)
            // Process data...
        }
    }
}
```

## File Naming Conventions

### App Configuration
- `app.vos` - Main app manifest (Y format)
- `config.vos` - App configuration (Y or J format)
- `theme.vos` - Theme configuration (Y format)

### Layouts
- `layout.vos` - Main layout (D format)
- `home.vos`, `settings.vos` - Screen-specific layouts (D format)
- `component-*.vos` - Reusable component definitions (D format)

### Generated Code
- `generated.vos` - AvaCode output (K format)
- `*-compose.vos` - Jetpack Compose code (K format)
- `*-swiftui.vos` - SwiftUI code (K format)

### Data Files
- `data.vos` - Static data (J format)
- `state.vos` - App state snapshots (J format)
- `cache.vos` - Cache data (J format)

## Migration from Legacy Formats

### From .yaml/.yml
```bash
# Add type flag to beginning
echo "#!vos:Y\n$(cat app.yaml)" > app.vos
```

### From .dsl
```bash
# Add type flag to beginning
echo "#!vos:D\n$(cat layout.dsl)" > layout.vos
```

### From .kt
```bash
# Add type flag (convert # to //)
sed '1s/^/#!vos:K\n/' generated.kt > generated.vos
```

### From .json
```bash
# Add type flag to beginning
echo "#!vos:J\n$(cat data.json)" > data.vos
```

## Benefits

### For Developers
- **Single file extension** - Easier to identify VoiceOS files
- **Format flexibility** - Choose best format for each use case
- **Quick detection** - Read one line to determine processing strategy
- **Tool compatibility** - Editors can detect format via shebang

### For Runtime
- **Fast parsing** - No need to guess or try multiple parsers
- **Error handling** - Clear error messages for wrong format
- **Validation** - Enforce correct format for each file type

### For App Store
- **Clear compliance** - Easy to verify configuration vs code
- **Automated checks** - Scripts can validate file contents
- **Documentation** - Type flags serve as inline documentation

## Implementation Checklist

- [X] Define `.vos` extension and type flags
- [X] Create example files for each format type
- [X] Document runtime detection logic
- [ ] Implement VosFileType enum in AvaUI library
- [ ] Create file parsers for each format
- [ ] Add validation for type flag syntax
- [ ] Update AvaCode generator to output .vos files
- [ ] Create migration scripts for legacy formats
- [ ] Add .vos syntax highlighting for IDEs
- [ ] Update documentation and examples

## Version History

- **1.0.0** (2025-10-27): Initial specification with Y/D/K/J type flags

---

**Created by Manoj Jhawar, manoj@ideahq.net**
