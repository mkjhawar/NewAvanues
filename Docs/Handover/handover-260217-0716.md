# Session Handover - 260217-0716

## Current State
- **Repo:** NewAvanues
- **Branch:** `IosVoiceOS-Development`
- **Mode:** Interactive
- **Working Directory:** `/Volumes/M-Drive/Coding/NewAvanues/Modules/VoiceOSCore`
- **API:** OFF (working offline)

## Task In Progress

**Cockpit SpatialVoice Redesign** — comprehensive multi-phase plan to transform the Cockpit module from a basic tiling window manager into a SpatialVoice-themed multi-window system with pseudo-spatial head-tracking, carousel layout, command bar, and full AvanueUI v5.1 tokenization.

Planning phase is COMPLETE. Implementation has NOT started.

## Completed This Session

1. **Read and analyzed entire Cockpit module** — all 8 androidMain files + 13 commonMain model files
2. **Read IMU integration API** — `IMUPublicAPI.kt` (orientationFlow, eulerAngles), `IMUModels.kt` (KMP orientation models)
3. **Identified KMP architecture gap** — Cockpit missing JB Compose Multiplatform plugin (`alias(libs.plugins.compose)`) preventing Compose in commonMain; AvanueUI already has it
4. **Created comprehensive plan document** — `docs/plans/Cockpit/Cockpit-Plan-SpatialVoiceRedesign-260217-V1.md`
   - 6 phases, ~2,200 estimated lines
   - KMP-first: ~80% code in commonMain
   - AvanueUI v5.1 tokenization throughout (all 32 theme combos)
   - Platform-specific only for hardware (IMU) and native views (WebView/CameraX)

## Next Steps (CONTINUE THESE)

### Batch 1: Build Config + Models (Phase 0 + 1)
1. [ ] Update `Modules/Cockpit/build.gradle.kts` — add `alias(libs.plugins.compose)` plugin, move Compose + AvanueUI deps from androidMain to commonMain
2. [ ] Verify build compiles on Android + Desktop targets
3. [ ] Add `CAROUSEL`, `SPATIAL_DICE`, `GALLERY` to `LayoutMode.kt` enum
4. [ ] Create `SpatialPosition.kt` in commonMain/model/
5. [ ] Create `CommandBarState.kt` in commonMain/model/
6. [ ] Create `ContentAccent.kt` in commonMain/model/
7. [ ] Update `CockpitFrame.kt` — add `spatialPosition: SpatialPosition` field
8. [ ] Update `CockpitSession.kt` — add `backgroundUri: String?` field
9. [ ] Update `CockpitConstants.kt` — add spatial/carousel/command-bar constants

### Batch 2: Move Existing UI to commonMain (Phase 2 + 5)
10. [ ] Move `FrameWindow.kt` → commonMain (enhance with themed borders, content icons, glass title bar)
11. [ ] Move `FreeformCanvas.kt` → commonMain (no changes needed)
12. [ ] Move `MinimizedTaskbar.kt` → commonMain (no changes needed)
13. [ ] Move `LayoutEngine.kt` → commonMain

### Batch 3: New Layouts (Phase 2)
14. [ ] Create `CarouselLayout.kt` — HorizontalPager + graphicsLayer 3D perspective
15. [ ] Create `SpatialDiceLayout.kt` — 4 corners + center pattern
16. [ ] Create `GalleryLayout.kt` — media-only filtered grid
17. [ ] Create `WorkflowSidebar.kt` — redesigned sidebar 30/70 split
18. [ ] Wire new layouts into LayoutEngine `when` block

### Batch 4: Command Bar (Phase 3)
19. [ ] Create `CommandBar.kt` — bottom-docked action bar with AvanueChip
20. [ ] Create `CockpitScreenContent.kt` in commonMain (takes frameContent lambda)
21. [ ] Update `CockpitScreen.kt` in androidMain as thin wrapper providing ContentRenderer
22. [ ] Wire command bar state transitions

### Batch 5: Spatial Canvas (Phase 4)
23. [ ] Create `ISpatialOrientationSource.kt` interface (commonMain)
24. [ ] Create `AndroidSpatialOrientationSource.kt` (androidMain, wraps IMUPublicAPI)
25. [ ] Create `DesktopSpatialOrientationSource.kt` (desktopMain, stub)
26. [ ] Create `SpatialViewportController.kt` (commonMain, lerp + deadzone)
27. [ ] Create `SpatialCanvas.kt` composable (commonMain, graphicsLayer translation)
28. [ ] Add lock/unlock ViewModel logic
29. [ ] Phone/tablet fallback gestures (swipe, edge peek)

### Batch 6: Polish (Phase 5 + 6)
30. [ ] Create `LayoutModeResolver.kt` — device-specific layout availability
31. [ ] XR glass adaptations (colorsXR, minimal chrome, enlarged targets)
32. [ ] Phone carousel default + bottom sheet adaptations
33. [ ] Touch target enforcement via DisplayUtils

## Files Modified (This Session)
| File | Changes |
|------|---------|
| `docs/plans/Cockpit/Cockpit-Plan-SpatialVoiceRedesign-260217-V1.md` | NEW — Full redesign plan (450+ lines) |

## Uncommitted Changes (Pre-existing from previous sessions)

**Modified (21 files):**
- Cockpit module (8 files): CockpitScreen, FrameWindow, FreeformCanvas, LayoutEngine, MinimizedTaskbar, CockpitViewModel, CockpitConstants, LayoutMode — these are the existing Cockpit multi-window system from commit `79205fb1`
- Content modules (6 files): AnnotationCanvas, SignatureCapture, CameraPreview, ImageViewer, NoteEditor, PdfViewer, VideoPlayer, CastOverlay — Cockpit content renderers
- App (4 files): avanues build.gradle.kts, AndroidManifest, MainActivity, HubDashboardScreen
- Repository: ICockpitRepository

**Untracked (3 items):**
- `Docs/Plans/Cockpit/` — plan directory
- `apps/avanues/src/main/kotlin/.../ui/cockpit/` — cockpit app integration
- `apps/avanues/src/main/kotlin/.../ui/hub/HubModule.kt` + `SpatialOrbitHub.kt` — hub navigation

## Context for Continuation

### User Requirements (Confirmed During Session)
1. **KMP-first** — maximize commonMain code for cross-platform (Android + Desktop + future iOS)
2. **AvanueUI v5.1 tokenization** — use decoupled palette/style/appearance system throughout
3. **Theme flexibility** — AvanueUI components OR native as needed (via config.theme.json)
4. **Plan document first** — user explicitly asked for plan before implementation

### Key Technical Discovery
- **Cockpit build.gradle.kts** is missing `alias(libs.plugins.compose)` (JB Compose Multiplatform plugin). AvanueUI has it. Adding it to Cockpit enables `compose.runtime`/`compose.foundation`/`compose.material3` in commonMain — this is the gating change for the KMP-first approach.
- All existing Cockpit composables (FrameWindow, FreeformCanvas, LayoutEngine, MinimizedTaskbar) are pure Compose with NO Android-specific APIs — they can move to commonMain as-is after the plugin is added.
- Only `ContentRenderer.kt` (uses AndroidView for WebView/CameraX) and `AndroidCockpitRepository.kt` (SQLDelight Android driver) MUST stay in androidMain.

### Important Patterns
- `CockpitViewModel` is a plain Kotlin class (not AndroidX ViewModel) — already KMP-compatible
- Frame content rendering uses composable lambda slot (`frameContent: @Composable (CockpitFrame) -> Unit`) — this pattern enables commonMain layouts to work without importing platform-specific content renderers
- IMU integration via `IMUPublicAPI.orientationFlow` → `EulerAnglesData(yaw, pitch, roll)` in radians, multi-consumer safe via `startIMUTracking(consumerId)`

### Plan Document Location
`docs/plans/Cockpit/Cockpit-Plan-SpatialVoiceRedesign-260217-V1.md`

## Quick Resume
```
Read /Volumes/M-Drive/Coding/NewAvanues/docs/handover/handover-260217-0716.md and continue where we left off
```

Also read the full plan:
```
Read /Volumes/M-Drive/Coding/NewAvanues/docs/plans/Cockpit/Cockpit-Plan-SpatialVoiceRedesign-260217-V1.md
```

Start implementation with **Batch 1** (build.gradle.kts change + model files).
