# Session Handover - 2026-02-19 01:00

## Current State
- **Repo:** NewAvanues
- **Branch:** Cockpit-Development
- **Mode:** YOLO (.cot .tot .swarm)
- **Working Directory:** /Volumes/M-Drive/Coding/NewAvanues
- **Git Status:** Clean (all committed and pushed to all 4 branches)

## Task In Progress
Full implementation spec + plan + implementation of 6 modules: RemoteCast, AnnotationAvanue, ImageAvanue, VideoAvanue, AI, AVA. User requested `/i.spec /i.plan .tot .cot .yolo .swarm` with maximum KMP, AvanueUI, standalone + Cockpit integration.

## Completed This Session

### Previous Session (carried over)
1. Domain Activation System (VoiceOSCore) — commit `e0772b96`
2. Web DOM Scraping Persistence — commit `ceb6a9b6`
3. VOS Phase C Phrase Suggestions — commit `f8cbb566`
4. PhotoAvanue Pro Camera + CameraX Extensions — commit `b82abed3`
5. iOS Avanues App Phase 3 Voice Recognition — commit `06a8f309`
6. Pushed ALL commits to ALL 4 branches (Cockpit-Development, IosVoiceOS-Development, VoiceOSCore-KotlinUpdate, kmpvoiceos-update)

### This Session
7. **Research Phase COMPLETE** — 7 swarm agents completed deep research on all 6 modules + Cockpit integration patterns:
   - RemoteCast: 2 files exist (CastState.kt + CastOverlay.kt), Cockpit already wired, missing capture/encode/decode pipeline
   - AnnotationAvanue: 3 files (model + AnnotationCanvas + SignatureCapture), Cockpit wired, stroke persistence BROKEN, missing shape tools/color picker/voice commands
   - ImageAvanue: 2 files (ImageItem.kt + ImageViewer.kt), Cockpit wired, missing gallery/editor/voice commands, ImageViewerState model unused
   - VideoAvanue: 2 files (VideoItem.kt + VideoPlayer.kt), Cockpit wired, missing IVideoController/voice commands/desktop/iOS
   - AI: MASSIVE existing codebase (316 files across 7 sub-modules: ALC, LLM, RAG, NLU, Chat, Memory, Teach) — production-grade, needs unification of ALC vs LLM cloud providers, Memory androidMain missing
   - AVA: 4 submodules (core:Utils, core:Domain, core:Data, Overlay) — production foundation, Overlay needs AvanueUI v5.1 migration, legacy non-KMP files in core:Data
   - Cockpit integration: 5-location checklist documented (FrameContent, ContentRenderer, FrameWindow icon, ContentAccent, Repository fallback)

8. Read CommandActionType.kt (756 lines, all action types mapped)
9. Read ActionCategory.kt (15 categories, need to add ANNOTATION, IMAGE, VIDEO, CAST)
10. Read en-US.app.vos (177 lines, all current VOS commands)

## Next Steps (CONTINUE THESE)

### Step 1: Create Spec Document (Task #7)
Write unified spec to `docs/plans/Modules-Spec-SixModuleImplementation-260219-V1.md` covering:
- RemoteCast: ICastManager, MediaProjection capture, MJPEG-over-TCP, CastCaptureService
- AnnotationAvanue: Move to commonMain, IAnnotationController, shape tools, color picker, Bezier smoothing, stroke persistence fix
- ImageAvanue: IImageController, gallery screen, Coil 3 KMP, filter engine, MediaStore integration
- VideoAvanue: IVideoController, Media3 Transformer editor, JavaFX desktop, AVPlayer iOS
- AI: Unify ALC+LLM providers, Memory androidMain, wire ALC into VoiceOS 4-tier pipeline, Cockpit AI panel wiring
- AVA: Overlay AvanueUI v5.1 migration, clean up legacy non-KMP in core:Data

### Step 2: Create Implementation Plans (Task #8)
One plan per module in `docs/plans/{Module}/`:
- Each plan has phases, file-level detail, dependencies
- Cross-module: new ActionCategory values (ANNOTATION, IMAGE, VIDEO, CAST)
- Cross-module: new CommandActionType values (~60 new action types across all 6)
- Cross-module: VOS commands for all 5 locales
- Cross-module: AndroidHandlerFactory registration (4 new handlers)

### Step 3: Implement (Tasks #9-#14) — IN ORDER:
1. **AnnotationAvanue** (smallest, fixes P0 stroke persistence bug)
2. **ImageAvanue** (builds on annotation overlay capability)
3. **VideoAvanue** (similar pattern to ImageAvanue)
4. **RemoteCast** (most platform-specific, depends on Rpc transport)
5. **AI** (largest — unification + wiring, mostly existing code)
6. **AVA** (Overlay migration, cleanup — least new code)

## Key Research Findings (Context for Continuation)

### Cockpit Integration Pattern (5 mandatory locations)
1. `FrameContent.kt` (commonMain) — add sealed class variant
2. `ContentRenderer.kt` (androidMain) — add when-branch calling module composable
3. `FrameWindow.kt` — add icon mapping
4. `ContentAccent.kt` — add color mapping
5. `AndroidCockpitRepository.kt` — add deserialize fallback

### Module Current File Counts
| Module | Files | KMP Score | Status |
|--------|------:|-----------|--------|
| RemoteCast | 2 | ~15% | Shell only |
| AnnotationAvanue | 3 | ~15% | Broken persistence |
| ImageAvanue | 2 | ~10% | Minimal |
| VideoAvanue | 2 | ~10% | Basic player |
| AI (all 7 sub) | 316 | ~55% | Production |
| AVA (all 4 sub) | ~80 | ~60% | Production |

### New ActionCategory Values Needed
```kotlin
ANNOTATION,  // Priority 15 (after CAMERA=14, before CUSTOM=16)
IMAGE,       // Priority 16
VIDEO,       // Priority 17
CAST,        // Priority 18
```

### New CommandActionType Values Needed (~60 total)
- AnnotationAvanue: ~15 (ANNOTATION_PEN, ANNOTATION_HIGHLIGHTER, etc.)
- ImageAvanue: ~20 (IMAGE_ZOOM_IN, IMAGE_FILTER_GRAYSCALE, IMAGE_GALLERY, etc.)
- VideoAvanue: ~12 (VIDEO_PLAY, VIDEO_PAUSE, VIDEO_SEEK_FWD, VIDEO_SPEED_UP, etc.)
- RemoteCast: ~3 (ADD_SCREEN_CAST, CAST_CONNECT, CAST_DISCONNECT)
- AI: ~5 (AI_SUMMARIZE, AI_CHAT, AI_RAG_SEARCH, AI_TEACH, AI_CLEAR_CONTEXT)

### Key Libraries to Add
- `io.coil-kt.coil3:coil-compose` — KMP image loading for ImageAvanue
- `androidx.media3:media3-transformer` — Video editing for VideoAvanue
- `org.openjfx:javafx-media` — Desktop video playback
- `ktor-network` — TCP for RemoteCast streaming

### Existing Cockpit Wiring (Already Done)
- FrameContent.Image ✓, FrameContent.Video ✓, FrameContent.Whiteboard ✓, FrameContent.Signature ✓, FrameContent.ScreenCast ✓, FrameContent.AiSummary ✓
- All have ContentRenderer branches but many are stubs (no real state wiring)

## Files Modified This Session
None — this session was research-only. All code changes were in the previous session.

## Uncommitted Changes
None — clean working tree.

## Agent Research Output Files (Full Reports)
- RemoteCast: `/private/tmp/claude-501/-Volumes-M-Drive-Coding-NewAvanues/tasks/a5a5ec6.output`
- AnnotationAvanue: `/private/tmp/claude-501/-Volumes-M-Drive-Coding-NewAvanues/tasks/a22eeeb.output`
- ImageAvanue: `/private/tmp/claude-501/-Volumes-M-Drive-Coding-NewAvanues/tasks/a011f67.output`
- VideoAvanue: `/private/tmp/claude-501/-Volumes-M-Drive-Coding-NewAvanues/tasks/a6a1fdb.output`
- AI: `/private/tmp/claude-501/-Volumes-M-Drive-Coding-NewAvanues/tasks/a7a228b.output`
- AVA: `/private/tmp/claude-501/-Volumes-M-Drive-Coding-NewAvanues/tasks/ae010be.output`
- Cockpit Integration: `/private/tmp/claude-501/-Volumes-M-Drive-Coding-NewAvanues/tasks/a2c8ac2.output`

**NOTE:** These are in /tmp and will be lost on reboot. The key findings are summarized above and should be sufficient for continuation.

## Quick Resume
```
Read /Volumes/M-Drive/Coding/NewAvanues/docs/handover/handover-260219-0100.md and continue where we left off. Start with Step 1: Create the unified spec document, then Step 2: Create per-module implementation plans, then Step 3: Implement all 6 modules in order. Use .yolo .swarm .cot .tot modifiers.
```
