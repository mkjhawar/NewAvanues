package com.augmentalis.magiccode.plugins.mocks

import com.augmentalis.magiccode.plugins.core.*

/**
 * Mock implementation of PluginRegistry for testing.
 *
 * Provides simplified registry functionality without persistence.
 */
class MockPluginRegistry {
    private val plugins = mutableMapOf<String, PluginRegistry.PluginInfo>()

    suspend fun register(manifest: PluginManifest, namespace: PluginNamespace): Boolean {
        if (plugins.containsKey(manifest.id)) {
            return false
        }
        plugins[manifest.id] = PluginRegistry.PluginInfo(
            manifest = manifest,
            state = PluginState.INSTALLED,
            loadedAt = System.currentTimeMillis(),
            namespace = namespace
        )
        return true
    }

    suspend fun unregister(pluginId: String): Boolean {
        return plugins.remove(pluginId) != null
    }

    suspend fun updateState(pluginId: String, newState: PluginState): Boolean {
        val oldInfo = plugins[pluginId] ?: return false
        plugins[pluginId] = oldInfo.copy(state = newState)
        return true
    }

    suspend fun getPlugin(pluginId: String): PluginRegistry.PluginInfo? {
        return plugins[pluginId]
    }

    fun getAllPlugins(): Map<String, PluginRegistry.PluginInfo> {
        return plugins.toMap()
    }

    fun clear() {
        plugins.clear()
    }
}
