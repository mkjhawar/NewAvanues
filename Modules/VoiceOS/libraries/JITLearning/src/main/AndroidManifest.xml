<?xml version="1.0" encoding="utf-8"?>
<!--
  JITLearning Module Manifest

  Declares JITLearningService as foreground service.
  Service will be started by VoiceOSCore app.

  Author: Manoj Jhawar
  Created: 2025-12-11 (JIT-LearnApp Separation)
  Updated: 2025-12-12 (Security: Added signature-level permission)
  Updated: 2025-12-15 (Fix: Use string resources for permission description)
-->
<manifest xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- ========== PERMISSIONS ========== -->

    <!-- Foreground service permission (required for Android 9+) -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />

    <!-- FIX (2025-12-29): Android 14+ requires specific permission for dataSync foreground service type -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_DATA_SYNC" />

    <!-- JIT Control Permission (signature-level protection) -->
    <!-- SECURITY: Only apps signed with same certificate can access JIT service -->
    <!-- This prevents malicious apps from:
         - Pausing/resuming learning to hide malicious UI
         - Accessing learned screen data (privacy)
         - Executing accessibility actions (privilege escalation)
         - Monitoring user interactions (surveillance)
    -->
    <permission
        android:name="com.augmentalis.voiceos.permission.JIT_CONTROL"
        android:label="@string/perm_jit_control_label"
        android:description="@string/perm_jit_control_description"
        android:protectionLevel="signature|privileged" />

    <application>
        <!--
          JIT Learning Service

          Runs as foreground service in VoiceOSCore process.
          Provides AIDL interface for LearnApp coordination.

          Properties:
          - enabled: true (always available)
          - exported: true (accessible from other apps via AIDL)
          - permission: signature-level protection (CVE-2025-XXXX mitigation)
          - foregroundServiceType: dataSync (passive learning = data synchronization)

          SECURITY (2025-12-12):
          - Added signature-level permission requirement
          - Prevents unauthorized access to accessibility data (HIGH severity)
          - Prevents privilege escalation via automation API (HIGH severity)
        -->
        <service
            android:name=".JITLearningService"
            android:enabled="true"
            android:exported="true"
            android:permission="com.augmentalis.voiceos.permission.JIT_CONTROL"
            android:foregroundServiceType="dataSync">
            <intent-filter>
                <action android:name="com.augmentalis.jitlearning.ELEMENT_CAPTURE_SERVICE" />
            </intent-filter>
        </service>
    </application>

</manifest>
