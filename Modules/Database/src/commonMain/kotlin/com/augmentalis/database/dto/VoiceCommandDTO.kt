// Author: Manoj Jhawar

package com.augmentalis.database.dto

import kotlinx.datetime.Clock

/**
 * Data Transfer Object for VoiceCommand table.
 * Represents a voice command with locale support.
 *
 * Corresponds to VoiceCommand.sq schema.
 * Extended with synonyms, description, is_fallback for CommandManager compatibility.
 */
data class VoiceCommandDTO(
    val id: Long,
    val commandId: String,
    val locale: String,
    val triggerPhrase: String,
    val synonyms: String = "[]",
    val action: String,
    val description: String = "",
    val category: String,
    val domain: String = "app",
    val priority: Long,
    val isFallback: Long = 0,
    val isEnabled: Long,
    /** v3.1: Android resource ID for Layer 3 BoundsResolver lookup */
    val resourceId: String? = null,
    /** v3.1: Content-hash fingerprint for cross-session element matching */
    val elementHash: String? = null,
    /** v3.1: Element class name for tree search */
    val className: String? = null,
    val createdAt: Long,
    val updatedAt: Long
) {
    companion object {
        /**
         * Create a new VoiceCommandDTO with auto-generated timestamps.
         */
        fun create(
            commandId: String,
            locale: String,
            triggerPhrase: String,
            action: String,
            category: String,
            domain: String = "app",
            priority: Long = 0,
            isEnabled: Boolean = true,
            synonyms: String = "[]",
            description: String = "",
            isFallback: Boolean = false,
            resourceId: String? = null,
            elementHash: String? = null,
            className: String? = null
        ): VoiceCommandDTO {
            val now = Clock.System.now().toEpochMilliseconds()
            return VoiceCommandDTO(
                id = 0, // Will be auto-generated by database
                commandId = commandId,
                locale = locale,
                triggerPhrase = triggerPhrase,
                synonyms = synonyms,
                action = action,
                description = description,
                category = category,
                domain = domain,
                priority = priority,
                isFallback = if (isFallback) 1L else 0L,
                isEnabled = if (isEnabled) 1L else 0L,
                resourceId = resourceId,
                elementHash = elementHash,
                className = className,
                createdAt = now,
                updatedAt = now
            )
        }
    }
}

/**
 * Extension to convert SQLDelight entity to DTO.
 * RENAMED (2025-12-05): Voice_commands -> Commands_static
 */
fun com.augmentalis.database.Commands_static.toVoiceCommandDTO(): VoiceCommandDTO = VoiceCommandDTO(
    id = id,
    commandId = command_id,
    locale = locale,
    triggerPhrase = trigger_phrase,
    synonyms = synonyms,
    action = action,
    description = description,
    category = category,
    domain = domain,
    priority = priority,
    isFallback = is_fallback,
    isEnabled = is_enabled,
    resourceId = resource_id,
    elementHash = element_hash,
    className = class_name,
    createdAt = created_at,
    updatedAt = updated_at
)
