package com.augmentalis.magiccode.plugins

/**
 * Mock implementation of PluginClassLoader for testing.
 *
 * Simulates class loading without actual platform-specific class loading.
 */
class MockPluginClassLoader {
    var shouldFailLoading = false
    var loadFailureMessage = "Mock class loading failure"
    var lastLoadedClass: String? = null
    var lastLoadedPath: String? = null
    var loadedClasses = mutableListOf<String>()

    /**
     * Load a class from the plugin.
     *
     * @param className Fully qualified class name
     * @param pluginPath Path to plugin library
     * @return Mock loaded class instance
     * @throws ClassNotFoundException if shouldFailLoading is true
     */
    fun loadClass(className: String, pluginPath: String): Any {
        lastLoadedClass = className
        lastLoadedPath = pluginPath

        if (shouldFailLoading) {
            throw ClassNotFoundException("$loadFailureMessage: $className")
        }

        loadedClasses.add(className)
        return "MockClass($className)"
    }

    /**
     * Unload plugin classes and release resources.
     */
    fun unload() {
        loadedClasses.clear()
        lastLoadedClass = null
        lastLoadedPath = null
    }

    /**
     * Reset mock state.
     */
    fun reset() {
        shouldFailLoading = false
        loadFailureMessage = "Mock class loading failure"
        lastLoadedClass = null
        lastLoadedPath = null
        loadedClasses.clear()
    }
}
