/**
 * InfrastructureTest.kt - Test infrastructure verification
 *
 * Verifies that all test infrastructure components work correctly.
 * This test should pass to confirm infrastructure is ready.
 *
 * Copyright (C) Manoj Jhawar/Aman Jhawar, Intelligent Devices LLC
 * Created: 2025-11-26
 */

package com.augmentalis.voiceoscore.test.infrastructure

import com.augmentalis.database.VoiceOSDatabase
import kotlinx.coroutines.ExperimentalCoroutinesApi
import kotlinx.coroutines.test.runTest
import org.junit.Assert.*
import org.junit.Test

/**
 * Test suite to verify test infrastructure is working.
 */
@ExperimentalCoroutinesApi
class InfrastructureTest : BaseRepositoryTest() {

    @Test
    fun testDatabaseCreation() {
        // Verify database was created
        assertNotNull("Database should be created", database)
    }

    @Test
    fun testDatabaseManagerCreation() {
        // Verify database manager was created
        assertNotNull("Database manager should be created", databaseManager)
    }

    @Test
    fun testDatabaseOperations() = runTest(coroutineRule.testDispatcher) {
        // Verify basic database operations work
        val stats = databaseManager.getStats()

        assertNotNull("Stats should not be null", stats)
        assertEquals("Command history count should be 0", 0L, stats.commandHistoryCount)
        assertEquals("Custom command count should be 0", 0L, stats.customCommandCount)
    }

    @Test
    fun testRepositoryAccess() {
        // Verify repositories are accessible
        assertNotNull("Commands repository should be accessible", databaseManager.commands)
        assertNotNull("Command history repository should be accessible", databaseManager.commandHistory)
        assertNotNull("User preferences repository should be accessible", databaseManager.userPreferences)
        assertNotNull("Error reports repository should be accessible", databaseManager.errorReports)
    }

    @Test
    fun testQueryAccess() {
        // Verify query objects are accessible
        assertNotNull("Command history queries should be accessible", databaseManager.commandHistoryQueries)
        assertNotNull("Custom command queries should be accessible", databaseManager.customCommandQueries)
        assertNotNull("User preference queries should be accessible", databaseManager.userPreferenceQueries)
    }

    @Test
    fun testClearDatabase() {
        // Test that clearDatabase works
        clearDatabase()
        assertNotNull("Database should still be accessible after clear", database)
    }

    @Test
    fun testCoroutineRule() = runTest(coroutineRule.testDispatcher) {
        // Verify coroutine dispatcher works
        assertNotNull("Coroutine rule should provide dispatcher", coroutineRule.testDispatcher)
    }

    @Test
    fun testDatabaseFactory() {
        // Test direct factory usage
        val driverFactory = TestDatabaseDriverFactory()
        val testDriver = driverFactory.createDriver()
        val testDb = VoiceOSDatabase(testDriver)
        assertNotNull("Factory should create database", testDb)
        testDriver.close()
    }

    @Test
    fun testCleanDatabaseFactory() {
        // Test clean database creation
        val cleanDb = TestDatabaseFactory.createCleanDatabase()
        assertNotNull("Factory should create clean database", cleanDb)
        // Don't close - it's managed by BaseRepositoryTest
    }

    @Test
    fun testDriverFactory() {
        // Test driver factory
        val driverFactory = TestDatabaseDriverFactory()
        val driver = driverFactory.createDriver()
        assertNotNull("Driver factory should create driver", driver)
        driver.close()
    }
}
