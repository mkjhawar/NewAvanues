# CommandStatus.yaml - Command Status Feedback Overlay
# AVAUI YAML format for command execution status display
#
# Copyright (C) Manoj Jhawar/Aman Jhawar, Intelligent Devices LLC
# Author: VOS4 Development Team
# Created: 2026-01-06
#
# Maps to: CommandStatusOverlay.kt, ConfidenceOverlay.kt

---
component:
  name: CommandStatus
  type: overlay
  platform: all
  description: |
    Displays visual feedback for voice command execution states.
    Shows status progression: LISTENING -> PROCESSING -> EXECUTING -> SUCCESS/ERROR
    Also integrates confidence display for speech recognition.

theme:
  inherit: VoiceOSCoreNGTheme
  tokens:
    statusListening: ${colors.statusListening}
    statusProcessing: ${colors.statusProcessing}
    statusSuccess: ${colors.statusSuccess}
    statusError: ${colors.statusError}
    confidenceHigh: ${colors.confidenceHigh}
    confidenceMedium: ${colors.confidenceMedium}
    confidenceLow: ${colors.confidenceLow}
    confidenceReject: ${colors.confidenceReject}

# ============================================================================
# LAYOUT STRUCTURE
# ============================================================================
layout:
  type: stack
  id: commandStatusRoot
  props:
    fillMaxSize: true
    alignment: bottomCenter

  children:
    # Main status card
    - widget: StatusCard
      id: statusCard
      props:
        alignment: bottomCenter
        margin:
          bottom: ${spacing.paddingXLarge}
          horizontal: ${spacing.paddingLarge}

      children:
        - widget: Container
          id: statusContainer
          props:
            background: ${colors.background}
            cornerRadius: ${shapes.cornerRadiusXLarge}
            padding:
              vertical: ${spacing.paddingMedium}
              horizontal: ${spacing.paddingLarge}
            elevation: ${elevation.high}
            minWidth: 200
            maxWidth: 320

          children:
            - widget: Column
              props:
                alignment: center
                spacing: ${spacing.spacingSmall}

              children:
                # Status icon with animated indicator
                - widget: StatusIndicator
                  id: statusIndicator
                  props:
                    size: ${sizes.iconLarge}
                    state: ${commandState}
                    animated: ${animations.enabled}

                  children:
                    # Icon based on state
                    - widget: Icon
                      id: statusIcon
                      props:
                        icon: ${getStatusIcon(commandState)}
                        size: ${sizes.iconLarge}
                        color: ${getStatusColor(commandState)}
                        animated: ${commandState == 'LISTENING' || commandState == 'PROCESSING'}

                    # Pulse ring animation for listening
                    - widget: PulseRing
                      condition: ${commandState == 'LISTENING'}
                      props:
                        color: ${colors.statusListening}
                        size: ${sizes.iconLarge + 16}
                        duration: 1500
                        repeat: infinite

                # Command text
                - widget: Text
                  id: commandText
                  condition: ${commandText.length > 0}
                  props:
                    text: ${commandText}
                    color: ${colors.textPrimary}
                    fontSize: ${typography.bodySize}
                    fontWeight: ${typography.fontWeightMedium}
                    textAlign: center
                    maxLines: 2
                  accessibility:
                    role: status
                    liveRegion: assertive

                # Status message
                - widget: Text
                  id: statusMessage
                  props:
                    text: ${message}
                    color: ${colors.textSecondary}
                    fontSize: ${typography.captionSize}
                    textAlign: center
                  accessibility:
                    role: status
                    liveRegion: polite

                # Confidence bar (when applicable)
                - widget: ConfidenceBar
                  id: confidenceBar
                  condition: ${showConfidence && confidence > 0}
                  props:
                    value: ${confidence}
                    width: 160
                    height: 8
                    cornerRadius: 4

                  children:
                    - widget: Row
                      props:
                        spacing: ${spacing.spacingSmall}
                        alignment: center

                      children:
                        # Progress bar
                        - widget: ProgressBar
                          props:
                            progress: ${confidence}
                            backgroundColor: ${colors.divider}
                            progressColor: ${getConfidenceColor(confidence)}
                            width: 120
                            height: 8
                            cornerRadius: 4

                        # Percentage text
                        - widget: Text
                          props:
                            text: ${formatPercentage(confidence)}
                            color: ${getConfidenceColor(confidence)}
                            fontSize: ${typography.smallSize}
                            fontWeight: ${typography.fontWeightBold}

# ============================================================================
# COMMAND STATES
# ============================================================================
commandStates:
  LISTENING:
    icon: mic
    color: ${colors.statusListening}
    animation: pulse
    message: ${text.listeningPrompt}
    audioFeedback: true

  PROCESSING:
    icon: sync
    color: ${colors.statusProcessing}
    animation: spin
    message: ${text.processingPrompt}

  EXECUTING:
    icon: play_arrow
    color: ${colors.statusProcessing}
    animation: none
    message: "Executing..."

  SUCCESS:
    icon: check_circle
    color: ${colors.statusSuccess}
    animation: bounce
    message: ${text.successPrompt}
    autoDismiss: 2000

  ERROR:
    icon: error
    color: ${colors.statusError}
    animation: shake
    message: ${text.errorPrompt}
    autoDismiss: 3000

# ============================================================================
# CONFIDENCE THRESHOLDS
# ============================================================================
confidenceThresholds:
  high:
    min: 0.8
    color: ${colors.confidenceHigh}
    label: "High"

  medium:
    min: 0.6
    color: ${colors.confidenceMedium}
    label: "Medium"

  low:
    min: 0.4
    color: ${colors.confidenceLow}
    label: "Low"

  reject:
    min: 0.0
    color: ${colors.confidenceReject}
    label: "Please repeat"

# ============================================================================
# STATES
# ============================================================================
states:
  - name: visible
    props:
      opacity: 1.0
      translateY: 0

  - name: hidden
    props:
      opacity: 0.0
      translateY: 50

  - name: listening
    description: "Actively listening for voice input"
    props:
      commandState: LISTENING

  - name: processing
    description: "Processing recognized speech"
    props:
      commandState: PROCESSING

  - name: executing
    description: "Executing matched command"
    props:
      commandState: EXECUTING

  - name: success
    description: "Command executed successfully"
    props:
      commandState: SUCCESS

  - name: error
    description: "Command execution failed"
    props:
      commandState: ERROR

# ============================================================================
# ANIMATIONS
# ============================================================================
animations:
  show:
    duration: ${animations.durationNormal}
    easing: ${animations.easingEnter}
    properties:
      opacity: { from: 0.0, to: 1.0 }
      translateY: { from: 50, to: 0 }

  hide:
    duration: ${animations.durationFast}
    easing: ${animations.easingExit}
    properties:
      opacity: { from: 1.0, to: 0.0 }
      translateY: { from: 0, to: 50 }

  pulse:
    duration: 1000
    repeat: infinite
    easing: easeInOut
    properties:
      scale: { from: 1.0, to: 1.1, to: 1.0 }
      opacity: { from: 1.0, to: 0.7, to: 1.0 }

  spin:
    duration: 1000
    repeat: infinite
    easing: linear
    properties:
      rotation: { from: 0, to: 360 }

  bounce:
    duration: 400
    easing: bounceOut
    properties:
      scale: { from: 0.8, to: 1.1, to: 1.0 }

  shake:
    duration: 500
    easing: linear
    properties:
      translateX: { keyframes: [0, -10, 10, -10, 10, 0] }

  stateTransition:
    duration: ${animations.durationNormal}
    easing: ${animations.easingDefault}
    properties:
      backgroundColor: { transition: true }

# ============================================================================
# ACCESSIBILITY
# ============================================================================
accessibility:
  role: alert
  liveRegion: assertive
  contentDescription: "Voice command status"

  announcements:
    onListening: "Listening for voice command"
    onProcessing: "Processing: ${commandText}"
    onExecuting: "Executing: ${commandText}"
    onSuccess: "Command successful: ${commandText}"
    onError: "Command failed: ${message}"
    confidenceHigh: "Confidence: ${formatPercentage(confidence)} - High"
    confidenceMedium: "Confidence: ${formatPercentage(confidence)} - May need confirmation"
    confidenceLow: "Confidence: ${formatPercentage(confidence)} - Low, consider alternatives"
    confidenceReject: "Could not understand. Please repeat."

  navigation:
    supportsFocus: false
    trapFocus: false

# ============================================================================
# DATA BINDINGS
# ============================================================================
data:
  commandState:
    type: CommandState
    required: true
    enum: ["LISTENING", "PROCESSING", "EXECUTING", "SUCCESS", "ERROR"]
    default: "LISTENING"
    description: "Current command execution state"

  commandText:
    type: string
    default: ""
    description: "The command being executed"

  message:
    type: string
    default: ""
    description: "Human-readable status message"

  confidence:
    type: number
    default: 0.0
    min: 0.0
    max: 1.0
    description: "Speech recognition confidence (0.0 to 1.0)"

  showConfidence:
    type: boolean
    default: true
    description: "Whether to show confidence bar"

  autoDismissDelay:
    type: number
    default: 2000
    description: "Auto-dismiss delay in ms for success/error states"

  timestamp:
    type: number
    computed: true
    description: "Unix timestamp of last update"

# ============================================================================
# FUNCTIONS
# ============================================================================
functions:
  getStatusIcon:
    params: [state]
    returns: string
    logic: |
      switch (state) {
        case "LISTENING": return "mic"
        case "PROCESSING": return "sync"
        case "EXECUTING": return "play_arrow"
        case "SUCCESS": return "check_circle"
        case "ERROR": return "error"
        default: return "help"
      }

  getStatusColor:
    params: [state]
    returns: color
    logic: |
      switch (state) {
        case "LISTENING": return statusListening
        case "PROCESSING": return statusProcessing
        case "EXECUTING": return statusProcessing
        case "SUCCESS": return statusSuccess
        case "ERROR": return statusError
        default: return colors.textSecondary
      }

  getConfidenceColor:
    params: [value]
    returns: color
    logic: |
      if (value >= 0.8) return confidenceHigh
      if (value >= 0.6) return confidenceMedium
      if (value >= 0.4) return confidenceLow
      return confidenceReject

  getConfidenceLevel:
    params: [value]
    returns: string
    logic: |
      if (value >= 0.8) return "HIGH"
      if (value >= 0.6) return "MEDIUM"
      if (value >= 0.4) return "LOW"
      return "REJECT"

  formatPercentage:
    params: [value]
    returns: string
    logic: |
      return Math.round(value * 100) + "%"

  formatPercentageDecimal:
    params: [value]
    returns: string
    logic: |
      return (Math.round(value * 1000) / 10).toFixed(1) + "%"

# ============================================================================
# MODES (Lite vs Dev)
# ============================================================================
modes:
  lite:
    showConfidence: false
    autoDismissDelay: 2000
    animations:
      enabled: true

  dev:
    showConfidence: true
    autoDismissDelay: 3000
    showTimestamp: true
    animations:
      enabled: true
