# LearnAppMain.yaml - Main Screen for LearnApp Functionality
# AVAUI YAML format for VoiceOSCoreNG LearnApp main screen
#
# Copyright (C) Manoj Jhawar/Aman Jhawar, Intelligent Devices LLC
# Author: VOS4 Development Team
# Created: 2026-01-06
#
# Maps to: LearnAppConfig.kt, LearnAppDevToggle.kt

---
component:
  name: LearnAppMain
  type: screen
  platform: all
  description: |
    Main screen for VoiceOSCoreNG LearnApp functionality.
    Displays learned apps, element count, and provides controls for
    learning mode. Supports both Lite and Dev variants.

theme:
  inherit: VoiceOSCoreNGTheme

# ============================================================================
# LAYOUT STRUCTURE
# ============================================================================
layout:
  type: scaffold
  id: learnAppMainScreen

  # App bar
  appBar:
    title: "LearnApp"
    subtitle: ${currentTier}
    backgroundColor: ${colors.surface}
    elevation: 0
    actions:
      - widget: IconButton
        id: settingsButton
        props:
          icon: settings
          size: ${sizes.iconMedium}
          color: ${colors.textPrimary}
        onTap: ${navigateToSettings}
        accessibility:
          role: button
          contentDescription: "Open settings"
          minTouchTarget: ${accessibility.minimumTouchTarget}

      - widget: IconButton
        id: helpButton
        props:
          icon: help_outline
          size: ${sizes.iconMedium}
          color: ${colors.textPrimary}
        onTap: ${showHelp}
        accessibility:
          role: button
          contentDescription: "Help"
          minTouchTarget: ${accessibility.minimumTouchTarget}

  # Main content
  body:
    - widget: Column
      props:
        fillMaxSize: true
        padding: ${spacing.paddingLarge}
        spacing: ${spacing.spacingLarge}

      children:
        # === Status Card ===
        - widget: StatusCard
          id: statusCard
          props:
            background: ${colors.surface}
            cornerRadius: ${shapes.cornerRadiusLarge}
            elevation: ${elevation.low}
            padding: ${spacing.paddingLarge}

          children:
            - widget: Row
              props:
                alignment: spaceBetween

              children:
                - widget: Column
                  props:
                    alignment: start
                    spacing: ${spacing.spacingTiny}

                  children:
                    - widget: Text
                      props:
                        text: "Learning Status"
                        color: ${colors.textSecondary}
                        fontSize: ${typography.captionSize}

                    - widget: Text
                      props:
                        text: ${isLearning ? 'Active' : 'Idle'}
                        color: ${isLearning ? colors.statusSuccess : colors.textPrimary}
                        fontSize: ${typography.titleSize}
                        fontWeight: ${typography.fontWeightBold}

                # Toggle switch
                - widget: Switch
                  id: learningToggle
                  props:
                    value: ${isLearning}
                    activeColor: ${colors.primary}
                    trackColor: ${colors.divider}
                  onChanged: ${toggleLearning}
                  accessibility:
                    role: switch
                    contentDescription: ${isLearning ? 'Disable learning mode' : 'Enable learning mode'}
                    minTouchTarget: ${accessibility.minimumTouchTarget}

        # === Stats Grid ===
        - widget: Row
          props:
            spacing: ${spacing.spacingMedium}

          children:
            # Apps Learned
            - widget: StatCard
              props:
                flex: 1
                background: ${colors.surface}
                cornerRadius: ${shapes.cornerRadiusMedium}
                padding: ${spacing.paddingMedium}
              children:
                - widget: Column
                  props:
                    alignment: center
                    spacing: ${spacing.spacingTiny}
                  children:
                    - widget: Text
                      props:
                        text: ${appsLearned}
                        color: ${colors.primary}
                        fontSize: 32
                        fontWeight: ${typography.fontWeightBold}
                    - widget: Text
                      props:
                        text: "Apps Learned"
                        color: ${colors.textSecondary}
                        fontSize: ${typography.smallSize}
                    - widget: Text
                      condition: ${maxAppsLearned != -1}
                      props:
                        text: "of ${maxAppsLearned}"
                        color: ${colors.textDisabled}
                        fontSize: ${typography.smallSize}

            # Elements Found
            - widget: StatCard
              props:
                flex: 1
                background: ${colors.surface}
                cornerRadius: ${shapes.cornerRadiusMedium}
                padding: ${spacing.paddingMedium}
              children:
                - widget: Column
                  props:
                    alignment: center
                    spacing: ${spacing.spacingTiny}
                  children:
                    - widget: Text
                      props:
                        text: ${formatNumber(totalElements)}
                        color: ${colors.statusSuccess}
                        fontSize: 32
                        fontWeight: ${typography.fontWeightBold}
                    - widget: Text
                      props:
                        text: "Total Elements"
                        color: ${colors.textSecondary}
                        fontSize: ${typography.smallSize}

            # Commands Generated
            - widget: StatCard
              props:
                flex: 1
                background: ${colors.surface}
                cornerRadius: ${shapes.cornerRadiusMedium}
                padding: ${spacing.paddingMedium}
              children:
                - widget: Column
                  props:
                    alignment: center
                    spacing: ${spacing.spacingTiny}
                  children:
                    - widget: Text
                      props:
                        text: ${formatNumber(commandsGenerated)}
                        color: ${colors.statusProcessing}
                        fontSize: 32
                        fontWeight: ${typography.fontWeightBold}
                    - widget: Text
                      props:
                        text: "Commands"
                        color: ${colors.textSecondary}
                        fontSize: ${typography.smallSize}

        # === Feature Status (Dev mode only) ===
        - widget: FeatureCard
          condition: ${currentTier == 'DEV'}
          props:
            background: ${colors.surface}
            cornerRadius: ${shapes.cornerRadiusMedium}
            padding: ${spacing.paddingMedium}

          children:
            - widget: Column
              props:
                spacing: ${spacing.spacingSmall}

              children:
                - widget: Text
                  props:
                    text: "Active Features"
                    color: ${colors.textSecondary}
                    fontSize: ${typography.captionSize}
                    fontWeight: ${typography.fontWeightMedium}

                - widget: Wrap
                  props:
                    spacing: ${spacing.spacingSmall}
                    runSpacing: ${spacing.spacingSmall}

                  children:
                    - widget: FeatureChip
                      props:
                        label: "AI"
                        enabled: ${enableAI}

                    - widget: FeatureChip
                      props:
                        label: "NLU"
                        enabled: ${enableNLU}

                    - widget: FeatureChip
                      props:
                        label: "Exploration"
                        enabled: ${enableExploration}

                    - widget: FeatureChip
                      props:
                        label: "Framework Detection"
                        enabled: ${enableFrameworkDetection}

                    - widget: FeatureChip
                      props:
                        label: "Caching"
                        enabled: ${cacheEnabled}

                    - widget: FeatureChip
                      props:
                        label: "Analytics"
                        enabled: ${analyticsEnabled}

        # === Learned Apps List ===
        - widget: Container
          props:
            flex: 1

          children:
            - widget: Column
              props:
                spacing: ${spacing.spacingSmall}

              children:
                # Section header
                - widget: Row
                  props:
                    alignment: spaceBetween

                  children:
                    - widget: Text
                      props:
                        text: "Learned Apps"
                        color: ${colors.textPrimary}
                        fontSize: ${typography.bodySize}
                        fontWeight: ${typography.fontWeightMedium}

                    - widget: TextButton
                      condition: ${learnedApps.length > 0}
                      props:
                        text: "Clear All"
                        color: ${colors.statusError}
                        fontSize: ${typography.smallSize}
                      onTap: ${confirmClearAll}
                      accessibility:
                        role: button
                        contentDescription: "Clear all learned apps"
                        minTouchTarget: ${accessibility.minimumTouchTarget}

                # Apps list
                - widget: ListView
                  id: appsList
                  props:
                    flex: 1

                  emptyState:
                    - widget: EmptyState
                      props:
                        icon: school
                        title: "No Apps Learned Yet"
                        message: "Open an app and enable learning mode to get started."

                  template:
                    forEach: ${learnedApps}
                    as: app
                    render:
                      - widget: AppListItem
                        id: app_${app.packageName}
                        props:
                          background: ${colors.surface}
                          cornerRadius: ${shapes.cornerRadiusSmall}
                          padding: ${spacing.paddingMedium}
                          marginBottom: ${spacing.spacingSmall}

                        children:
                          - widget: Row
                            props:
                              alignment: spaceBetween

                            children:
                              - widget: Row
                                props:
                                  spacing: ${spacing.spacingMedium}
                                  flex: 1

                                children:
                                  # App icon
                                  - widget: AppIcon
                                    props:
                                      packageName: ${app.packageName}
                                      size: 40
                                      cornerRadius: ${shapes.cornerRadiusSmall}

                                  # App info
                                  - widget: Column
                                    props:
                                      alignment: start
                                      flex: 1

                                    children:
                                      - widget: Text
                                        props:
                                          text: ${app.appName}
                                          color: ${colors.textPrimary}
                                          fontSize: ${typography.bodySize}
                                          fontWeight: ${typography.fontWeightMedium}
                                          maxLines: 1
                                          overflow: ellipsis

                                      - widget: Text
                                        props:
                                          text: "${app.elementCount} elements | ${app.commandCount} commands"
                                          color: ${colors.textSecondary}
                                          fontSize: ${typography.smallSize}

                                      - widget: Text
                                        condition: ${currentTier == 'DEV'}
                                        props:
                                          text: ${app.framework}
                                          color: ${colors.textDisabled}
                                          fontSize: ${typography.smallSize}

                              # Actions
                              - widget: Row
                                props:
                                  spacing: ${spacing.spacingSmall}

                                children:
                                  - widget: IconButton
                                    props:
                                      icon: refresh
                                      size: ${sizes.iconSmall}
                                      color: ${colors.textSecondary}
                                    onTap: ${() => refreshApp(app.packageName)}
                                    accessibility:
                                      role: button
                                      contentDescription: "Re-learn ${app.appName}"
                                      minTouchTarget: ${accessibility.minimumTouchTarget}

                                  - widget: IconButton
                                    props:
                                      icon: delete_outline
                                      size: ${sizes.iconSmall}
                                      color: ${colors.statusError}
                                    onTap: ${() => confirmDeleteApp(app.packageName)}
                                    accessibility:
                                      role: button
                                      contentDescription: "Delete ${app.appName}"
                                      minTouchTarget: ${accessibility.minimumTouchTarget}

                        accessibility:
                          role: listitem
                          contentDescription: "${app.appName}, ${app.elementCount} elements, ${app.commandCount} commands"

  # Floating action button
  fab:
    - widget: FloatingActionButton
      id: learnCurrentAppFab
      props:
        icon: add
        backgroundColor: ${colors.primary}
        iconColor: ${colors.onPrimary}
        extended: false
        elevation: ${elevation.medium}
      onTap: ${learnCurrentApp}
      accessibility:
        role: button
        contentDescription: "Learn current app"
        minTouchTarget: 56

# ============================================================================
# CUSTOM WIDGETS
# ============================================================================
widgets:
  FeatureChip:
    props:
      label: string
      enabled: boolean
    layout:
      - widget: Container
        props:
          background: ${enabled ? colors.primary : colors.divider}
          cornerRadius: ${shapes.cornerRadiusXLarge}
          padding:
            horizontal: ${spacing.paddingMedium}
            vertical: ${spacing.paddingSmall}
        children:
          - widget: Text
            props:
              text: ${label}
              color: ${enabled ? colors.onPrimary : colors.textDisabled}
              fontSize: ${typography.smallSize}

  EmptyState:
    props:
      icon: string
      title: string
      message: string
    layout:
      - widget: Column
        props:
          alignment: center
          padding: ${spacing.paddingXLarge}
        children:
          - widget: Icon
            props:
              icon: ${icon}
              size: 64
              color: ${colors.textDisabled}
          - widget: Text
            props:
              text: ${title}
              color: ${colors.textPrimary}
              fontSize: ${typography.titleSize}
              fontWeight: ${typography.fontWeightMedium}
              marginTop: ${spacing.spacingMedium}
          - widget: Text
            props:
              text: ${message}
              color: ${colors.textSecondary}
              fontSize: ${typography.bodySize}
              textAlign: center
              marginTop: ${spacing.spacingSmall}

# ============================================================================
# STATES
# ============================================================================
states:
  - name: idle
    props:
      isLearning: false

  - name: learning
    props:
      isLearning: true

  - name: loading
    props:
      isLoading: true

# ============================================================================
# ANIMATIONS
# ============================================================================
animations:
  screenEnter:
    duration: ${animations.durationNormal}
    easing: ${animations.easingEnter}
    properties:
      opacity: { from: 0.0, to: 1.0 }

  listItemAppear:
    duration: ${animations.durationFast}
    easing: ${animations.easingEnter}
    staggerDelay: 50
    properties:
      opacity: { from: 0.0, to: 1.0 }
      translateY: { from: 20, to: 0 }

  statUpdate:
    duration: ${animations.durationFast}
    easing: ${animations.easingDefault}
    properties:
      scale: { from: 1.0, to: 1.1, to: 1.0 }

# ============================================================================
# ACCESSIBILITY
# ============================================================================
accessibility:
  screenTitle: "LearnApp Main Screen"

  announcements:
    onLearningEnabled: "Learning mode enabled"
    onLearningDisabled: "Learning mode disabled"
    onAppLearned: "Learned ${appName} with ${elementCount} elements"
    onAppDeleted: "Deleted ${appName}"
    onAllCleared: "All learned apps cleared"

  navigation:
    supportsFocus: true
    focusOrder: [learningToggle, appsList, learnCurrentAppFab, settingsButton]

# ============================================================================
# DATA BINDINGS
# ============================================================================
data:
  # Configuration
  currentTier:
    type: string
    default: "LITE"
    computed: ${LearnAppConfig.getConfig().tier}

  maxAppsLearned:
    type: number
    computed: ${LearnAppConfig.getMaxAppsLearned()}

  maxElementsPerScan:
    type: number
    computed: ${LearnAppConfig.getMaxElementsPerScan()}

  # Feature flags
  enableAI:
    type: boolean
    computed: ${LearnAppConfig.isAIEnabled()}

  enableNLU:
    type: boolean
    computed: ${LearnAppConfig.isNLUEnabled()}

  enableExploration:
    type: boolean
    computed: ${LearnAppConfig.isExplorationEnabled()}

  enableFrameworkDetection:
    type: boolean
    computed: ${LearnAppConfig.isFrameworkDetectionEnabled()}

  cacheEnabled:
    type: boolean
    computed: ${LearnAppConfig.isCacheEnabled()}

  analyticsEnabled:
    type: boolean
    computed: ${LearnAppConfig.isAnalyticsEnabled()}

  # Runtime state
  isLearning:
    type: boolean
    default: false

  isLoading:
    type: boolean
    default: false

  # Statistics
  appsLearned:
    type: number
    default: 0

  totalElements:
    type: number
    default: 0

  commandsGenerated:
    type: number
    default: 0

  # App list
  learnedApps:
    type: "List<LearnedApp>"
    default: []

# ============================================================================
# FUNCTIONS
# ============================================================================
functions:
  toggleLearning:
    params: [value]
    returns: void
    logic: |
      isLearning = value
      // Platform-specific learning toggle

  learnCurrentApp:
    returns: void
    logic: |
      // Get current foreground app and learn it

  refreshApp:
    params: [packageName]
    returns: void
    logic: |
      // Re-learn the specified app

  confirmDeleteApp:
    params: [packageName]
    returns: void
    logic: |
      // Show confirmation dialog, then delete

  confirmClearAll:
    returns: void
    logic: |
      // Show confirmation dialog, then clear all

  navigateToSettings:
    returns: void
    logic: |
      // Navigate to settings screen

  showHelp:
    returns: void
    logic: |
      // Show help dialog/screen

  formatNumber:
    params: [num]
    returns: string
    logic: |
      if (num >= 1000000) return (num / 1000000).toFixed(1) + "M"
      if (num >= 1000) return (num / 1000).toFixed(1) + "K"
      return num.toString()

# ============================================================================
# MODES (Lite vs Dev)
# ============================================================================
modes:
  lite:
    showFeatureCard: false
    showFrameworkInfo: false
    maxAppsDisplay: 25

  dev:
    showFeatureCard: true
    showFrameworkInfo: true
    maxAppsDisplay: unlimited
    showDebugInfo: true
