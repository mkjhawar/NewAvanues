# ElementOverlay.yaml - Element Badge/Highlight Overlay
# AVAUI YAML format for numbered element selection overlay
#
# Copyright (C) Manoj Jhawar/Aman Jhawar, Intelligent Devices LLC
# Author: VOS4 Development Team
# Created: 2026-01-06
#
# Maps to: NumberedSelectionOverlay.kt, NumberOverlayStyle.kt

---
component:
  name: ElementOverlay
  type: overlay
  platform: all
  description: |
    Displays numbered badges over UI elements for voice selection.
    Users can say a number to select the corresponding element.
    Supports color-coded states: has name (green), no name (orange), disabled (grey).

theme:
  inherit: VoiceOSCoreNGTheme
  tokens:
    # Badge colors from theme
    badgeEnabledWithName: ${colors.badgeEnabledWithName}
    badgeEnabledNoName: ${colors.badgeEnabledNoName}
    badgeDisabled: ${colors.badgeDisabled}
    badgeTextColor: ${colors.textPrimary}
    tooltipBackground: ${colors.tooltipBackground}
    tooltipTextColor: ${colors.textPrimary}

# ============================================================================
# LAYOUT STRUCTURE
# ============================================================================
layout:
  type: stack
  id: elementOverlayRoot
  props:
    fillMaxSize: true
    clipToBounds: false

  children:
    # Instruction bar at top
    - widget: InstructionBar
      id: instructionBar
      condition: ${showInstructions}
      props:
        alignment: topCenter
        padding:
          top: ${spacing.paddingLarge}
          horizontal: ${spacing.paddingMedium}

      children:
        - widget: Container
          props:
            background: ${colors.background}
            cornerRadius: ${shapes.cornerRadiusLarge}
            padding: ${spacing.paddingMedium}
            elevation: ${elevation.medium}

          children:
            - widget: Text
              props:
                text: ${instructionText}
                style: instruction
                color: ${colors.textPrimary}
                fontSize: ${typography.instructionSize}
                textAlign: center
              accessibility:
                role: status
                liveRegion: polite
                contentDescription: ${instructionText}

    # Badge container - positions badges over elements
    - widget: BadgeLayer
      id: badgeLayer
      props:
        clipToBounds: false

      # Badges are rendered dynamically per item
      template:
        forEach: ${items}
        as: item
        render:
          - widget: NumberedBadge
            id: badge_${item.number}
            position:
              x: ${calculateBadgeX(item.bounds)}
              y: ${calculateBadgeY(item.bounds)}
            props:
              number: ${item.number}
              state: ${getBadgeState(item)}
              showLabel: ${item.hasName && item.label.length > 0}
              label: ${truncateLabel(item.label, 20)}

            children:
              # Badge circle
              - widget: Container
                id: badgeCircle_${item.number}
                props:
                  width: ${sizes.badgeSize}
                  height: ${sizes.badgeSize}
                  shape: ${badgeStyle.shape}
                  background: ${getBadgeColor(item)}
                  cornerRadius: ${badgeStyle.cornerRadius}
                  elevation: ${badgeStyle.dropShadow ? elevation.low : 0}
                  shadowColor: ${badgeStyle.shadowColor}
                  shadowRadius: ${badgeStyle.shadowRadius}
                  shadowOffsetY: ${badgeStyle.shadowOffsetY}
                  borderWidth: ${badgeStyle.strokeWidth}
                  borderColor: ${badgeStyle.shape == 'outlined' ? getBadgeColor(item) : 'transparent'}

                children:
                  - widget: Text
                    props:
                      text: ${item.number}
                      color: ${badgeTextColor}
                      fontSize: ${typography.badgeSize}
                      fontWeight: ${typography.fontWeightBold}
                      textAlign: center

                accessibility:
                  role: button
                  contentDescription: ${getItemDescription(item)}
                  enabled: ${item.isEnabled}
                  minTouchTarget: ${accessibility.minimumTouchTarget}

              # Optional label tooltip
              - widget: Tooltip
                id: tooltip_${item.number}
                condition: ${item.hasName && item.label.length > 0}
                position:
                  offsetY: ${spacing.tooltipOffsetY}
                props:
                  maxWidth: ${sizes.tooltipMaxWidth}
                  background: ${colors.tooltipBackground}
                  cornerRadius: ${shapes.cornerRadiusSmall}
                  padding: ${spacing.paddingSmall}

                children:
                  - widget: Text
                    props:
                      text: ${truncateLabel(item.label, 20)}
                      color: ${colors.textPrimary}
                      fontSize: ${typography.captionSize}

# ============================================================================
# BADGE STYLES (from NumberOverlayStyles)
# ============================================================================
badgeStyles:
  default:
    shape: filledCircle
    cornerRadius: ${sizes.badgeRadius}
    strokeWidth: 2
    dropShadow: true
    shadowRadius: 4
    shadowColor: "0x40000000"
    shadowOffsetY: 2

  highContrast:
    shape: filledCircle
    cornerRadius: 20
    strokeWidth: 3
    dropShadow: true
    shadowRadius: 6
    shadowColor: "0x40000000"
    shadowOffsetY: 2

  minimal:
    shape: filledCircle
    cornerRadius: ${sizes.badgeRadius}
    strokeWidth: 1
    dropShadow: false

  outlined:
    shape: outlinedCircle
    cornerRadius: ${sizes.badgeRadius}
    strokeWidth: 3
    dropShadow: false

  square:
    shape: square
    cornerRadius: 0
    strokeWidth: 2
    dropShadow: true

  roundedRect:
    shape: roundedRect
    cornerRadius: ${shapes.cornerRadiusSmall}
    strokeWidth: 2
    dropShadow: true

# ============================================================================
# ANCHOR POINTS
# ============================================================================
anchorPoints:
  topLeft:
    offsetX: ${spacing.badgeOffsetX}
    offsetY: ${spacing.badgeOffsetY}
    alignment: topLeft

  topRight:
    offsetX: -${spacing.badgeOffsetX}
    offsetY: ${spacing.badgeOffsetY}
    alignment: topRight

  bottomLeft:
    offsetX: ${spacing.badgeOffsetX}
    offsetY: -${spacing.badgeOffsetY}
    alignment: bottomLeft

  bottomRight:
    offsetX: -${spacing.badgeOffsetX}
    offsetY: -${spacing.badgeOffsetY}
    alignment: bottomRight

# ============================================================================
# STATES
# ============================================================================
states:
  - name: visible
    props:
      opacity: 1.0

  - name: hidden
    props:
      opacity: 0.0

  - name: itemSelected
    description: "When a specific item is being selected"
    props:
      selectedItemIndex: -1

# ============================================================================
# ANIMATIONS
# ============================================================================
animations:
  show:
    duration: ${animations.durationNormal}
    easing: ${animations.easingEnter}
    properties:
      opacity: { from: 0.0, to: 1.0 }
      scale: { from: 0.8, to: 1.0 }

  hide:
    duration: ${animations.durationFast}
    easing: ${animations.easingExit}
    properties:
      opacity: { from: 1.0, to: 0.0 }

  badgeAppear:
    duration: ${animations.durationFast}
    easing: ${animations.easingEnter}
    staggerDelay: 30  # ms between each badge
    properties:
      opacity: { from: 0.0, to: 1.0 }
      scale: { from: 0.5, to: 1.0 }

  badgeSelect:
    duration: ${animations.durationFast}
    easing: ${animations.easingDefault}
    properties:
      scale: { from: 1.0, to: 1.2, to: 1.0 }
      borderWidth: { from: 2, to: 4, to: 2 }

# ============================================================================
# ACCESSIBILITY
# ============================================================================
accessibility:
  role: list
  liveRegion: polite
  contentDescription: "Element selection overlay"

  announcements:
    onShow: "Element selection active. ${itemCount} items available. Say a number to select."
    onHide: "Element selection dismissed"
    onSelect: "Selected item ${selectedNumber}: ${selectedLabel}"
    noItems: "No items available"
    singleItem: "1 item available. Say a number to select."
    multipleItems: "${itemCount} items available. Say a number to select."

  navigation:
    supportsFocus: true
    focusOrder: sequential
    focusIndicatorWidth: ${accessibility.focusIndicatorWidth}
    focusIndicatorColor: ${colors.focusIndicator}

# ============================================================================
# DATA BINDINGS
# ============================================================================
data:
  # Input properties
  items:
    type: "List<NumberedItem>"
    required: true
    description: "List of numbered items to display"

  showInstructions:
    type: boolean
    default: true
    description: "Whether to show instruction bar"

  instructionText:
    type: string
    default: ${text.instructionDefault}
    description: "Instruction text to display"

  badgeStyle:
    type: string
    default: "default"
    enum: ["default", "highContrast", "minimal", "outlined", "square", "roundedRect"]
    description: "Badge style variant"

  anchorPoint:
    type: string
    default: "topRight"
    enum: ["topLeft", "topRight", "bottomLeft", "bottomRight"]
    description: "Badge anchor position relative to element"

  # Computed/derived values
  itemCount:
    computed: ${items.length}

  enabledItemCount:
    computed: ${items.filter(i => i.isEnabled).length}

# ============================================================================
# FUNCTIONS
# ============================================================================
functions:
  getBadgeColor:
    params: [item]
    returns: color
    logic: |
      if (!item.isEnabled) return badgeDisabled
      if (item.hasName) return badgeEnabledWithName
      return badgeEnabledNoName

  getBadgeState:
    params: [item]
    returns: string
    logic: |
      if (!item.isEnabled) return "disabled"
      if (item.hasName) return "hasName"
      return "noName"

  calculateBadgeX:
    params: [bounds]
    returns: number
    logic: |
      const anchor = anchorPoints[anchorPoint]
      switch (anchorPoint) {
        case "topLeft":
        case "bottomLeft":
          return bounds.left + anchor.offsetX
        case "topRight":
        case "bottomRight":
          return bounds.right - sizes.badgeSize + anchor.offsetX
      }

  calculateBadgeY:
    params: [bounds]
    returns: number
    logic: |
      const anchor = anchorPoints[anchorPoint]
      switch (anchorPoint) {
        case "topLeft":
        case "topRight":
          return bounds.top + anchor.offsetY
        case "bottomLeft":
        case "bottomRight":
          return bounds.bottom - sizes.badgeSize + anchor.offsetY
      }

  truncateLabel:
    params: [label, maxLength]
    returns: string
    logic: |
      if (label.length <= maxLength) return label
      return label.substring(0, maxLength - 3) + "..."

  getItemDescription:
    params: [item]
    returns: string
    logic: |
      const type = item.hasName && item.label ? item.label : "item " + item.number
      const state = !item.isEnabled ? ", disabled" : ""
      return item.number + ": " + type + state

# ============================================================================
# MODES (Lite vs Dev)
# ============================================================================
modes:
  lite:
    maxItems: 100
    showInstructions: true
    badgeStyle: default
    animations:
      enabled: true

  dev:
    maxItems: 500
    showInstructions: true
    badgeStyle: default
    enableDebugInfo: true
    animations:
      enabled: true
