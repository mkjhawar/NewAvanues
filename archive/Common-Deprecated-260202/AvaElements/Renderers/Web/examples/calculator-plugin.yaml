# Calculator Plugin - MEL Example
# Demonstrates Tier 2 features (auto-downgrades to Tier 1 on Apple)

plugin:
  id: "calculator"
  name: "Calculator"
  version: "1.0.0"
  author: "Augmentalis"
  description: "A simple calculator demonstrating MEL plugin system"
  tier: logic  # Request Tier 2 (Web supports this, iOS would downgrade)

state:
  display: "0"
  buffer: ""
  operator: null
  history: []  # Tier 2 feature

reducers:
  appendDigit:
    params: [digit]
    next_state:
      display: $logic.if(
        $logic.equals($state.display, "0"),
        $digit,
        $string.concat($state.display, $digit)
      )

  appendDecimal:
    next_state:
      display: $logic.if(
        $string.indexOf($state.display, ".") >= 0,
        $state.display,
        $string.concat($state.display, ".")
      )

  setOperator:
    params: [op]
    next_state:
      buffer: $state.display
      operator: $op
      display: "0"

  calculate:
    next_state:
      display: $math.eval($state.buffer, $state.operator, $state.display)
      buffer: ""
      operator: null

  clear:
    next_state:
      display: "0"
      buffer: ""
      operator: null

  clearAll:
    next_state:
      display: "0"
      buffer: ""
      operator: null
      history: []

ui:
  Column:
    style: { padding: 16, maxWidth: 400 }
    children:
      # Display
      - Text:
          value: $state.display
          style:
            fontSize: 48
            textAlign: end
            fontFamily: monospace
            padding: 16
            backgroundColor: "#f5f5f5"
            borderRadius: 8

      - Divider: { margin: 2 }

      # Row 1: 7 8 9 ÷
      - Row:
          style: { gap: 8 }
          children:
            - Button:
                label: "7"
                onTap: "appendDigit(7)"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "8"
                onTap: "appendDigit(8)"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "9"
                onTap: "appendDigit(9)"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "÷"
                onTap: "setOperator('/')"
                variant: "outlined"
                style: { flex: 1, minWidth: 60 }

      # Row 2: 4 5 6 ×
      - Row:
          style: { gap: 8 }
          children:
            - Button:
                label: "4"
                onTap: "appendDigit(4)"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "5"
                onTap: "appendDigit(5)"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "6"
                onTap: "appendDigit(6)"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "×"
                onTap: "setOperator('*')"
                variant: "outlined"
                style: { flex: 1, minWidth: 60 }

      # Row 3: 1 2 3 −
      - Row:
          style: { gap: 8 }
          children:
            - Button:
                label: "1"
                onTap: "appendDigit(1)"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "2"
                onTap: "appendDigit(2)"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "3"
                onTap: "appendDigit(3)"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "−"
                onTap: "setOperator('-')"
                variant: "outlined"
                style: { flex: 1, minWidth: 60 }

      # Row 4: C 0 = +
      - Row:
          style: { gap: 8 }
          children:
            - Button:
                label: "C"
                onTap: "clear"
                variant: "outlined"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "0"
                onTap: "appendDigit(0)"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "."
                onTap: "appendDecimal"
                style: { flex: 1, minWidth: 60 }
            - Button:
                label: "="
                onTap: "calculate"
                variant: "contained"
                style: { flex: 1, minWidth: 60 }

      # Row 5: + (full width)
      - Button:
          label: "+"
          onTap: "setOperator('+')"
          variant: "outlined"
          style: { width: "100%" }
