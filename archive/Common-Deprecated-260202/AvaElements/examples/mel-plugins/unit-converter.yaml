# unit-converter.yaml
# A unit converter plugin demonstrating calculations and dropdowns
# Tier: data (Apple-safe)
#
# Features:
# - Convert between different units
# - Multiple unit categories (length, weight, temperature)
# - Real-time conversion
# - Bidirectional conversion

plugin:
  id: "com.augmentalis.unitconverter"
  name: "Unit Converter"
  version: "1.0.0"
  description: "Convert between different units of measurement"
  tier: data

state:
  value: "1"             # Input value
  fromUnit: "m"          # Source unit
  toUnit: "ft"           # Target unit
  result: "3.28084"      # Calculated result

  # Unit definitions with conversion factors to base unit
  units:
    length:
      - { id: "m", name: "Meters", factor: 1 }
      - { id: "ft", name: "Feet", factor: 3.28084 }
      - { id: "in", name: "Inches", factor: 39.3701 }
      - { id: "km", name: "Kilometers", factor: 0.001 }
      - { id: "mi", name: "Miles", factor: 0.000621371 }
      - { id: "cm", name: "Centimeters", factor: 100 }
    weight:
      - { id: "kg", name: "Kilograms", factor: 1 }
      - { id: "lb", name: "Pounds", factor: 2.20462 }
      - { id: "oz", name: "Ounces", factor: 35.274 }
      - { id: "g", name: "Grams", factor: 1000 }
    temperature:
      - { id: "c", name: "Celsius", factor: 1 }
      - { id: "f", name: "Fahrenheit", factor: 1.8 }
      - { id: "k", name: "Kelvin", factor: 1 }

reducers:
  # Update input value and recalculate
  setValue:
    params: [newValue]
    next_state:
      value: $newValue
      result: $string.concat("", $math.multiply(
        $math.parse($newValue),
        $math.divide(
          $object.get($array.first($array.filter($object.get($state.units, "length"), "unit", $logic.equals($object.get($unit, "id"), $state.toUnit))), "factor"),
          $object.get($array.first($array.filter($object.get($state.units, "length"), "unit", $logic.equals($object.get($unit, "id"), $state.fromUnit))), "factor")
        )
      ))

  # Change source unit
  setFromUnit:
    params: [unit]
    next_state:
      fromUnit: $unit
      result: $string.concat("", $math.multiply(
        $math.parse($state.value),
        $math.divide(
          $object.get($array.first($array.filter($object.get($state.units, "length"), "u", $logic.equals($object.get($u, "id"), $state.toUnit))), "factor"),
          $object.get($array.first($array.filter($object.get($state.units, "length"), "u", $logic.equals($object.get($u, "id"), $unit))), "factor")
        )
      ))

  # Change target unit
  setToUnit:
    params: [unit]
    next_state:
      toUnit: $unit
      result: $string.concat("", $math.multiply(
        $math.parse($state.value),
        $math.divide(
          $object.get($array.first($array.filter($object.get($state.units, "length"), "u", $logic.equals($object.get($u, "id"), $unit))), "factor"),
          $object.get($array.first($array.filter($object.get($state.units, "length"), "u", $logic.equals($object.get($u, "id"), $state.fromUnit))), "factor")
        )
      ))

  # Swap from and to units
  swapUnits:
    next_state:
      fromUnit: $state.toUnit
      toUnit: $state.fromUnit
      value: $state.result
      result: $state.value

ui:
  Column:
    style:
      padding: 16
      gap: 24
    children:
      # Header
      - Text:
          value: "Unit Converter"
          style:
            fontSize: 28
            fontWeight: "bold"

      - Divider: {}

      # From section
      - Column:
          style:
            gap: 12
          children:
            - Text:
                value: "From"
                style:
                  fontSize: 16
                  fontWeight: "medium"
                  color: "#666"
            - Row:
                style:
                  gap: 12
                children:
                  - TextField:
                      value: $state.value
                      placeholder: "Enter value"
                      keyboardType: "numeric"
                      onChange: "setValue"
                      style:
                        flex: 2
                        fontSize: 24
                  - Dropdown:
                      value: $state.fromUnit
                      options: $object.get($state.units, "length")
                      optionLabel: "name"
                      optionValue: "id"
                      onChange: "setFromUnit"
                      style:
                        flex: 1

      # Swap button
      - Row:
          style:
            justifyContent: "center"
          children:
            - Button:
                label: "â‡… Swap"
                onTap: "swapUnits"
                variant: "outline"
                style:
                  fontSize: 18

      # To section
      - Column:
          style:
            gap: 12
          children:
            - Text:
                value: "To"
                style:
                  fontSize: 16
                  fontWeight: "medium"
                  color: "#666"
            - Row:
                style:
                  gap: 12
                children:
                  - Container:
                      style:
                        flex: 2
                        backgroundColor: "#f5f5f5"
                        borderRadius: 8
                        padding: 16
                      children:
                        - Text:
                            value: $state.result
                            style:
                              fontSize: 24
                              fontWeight: "medium"
                  - Dropdown:
                      value: $state.toUnit
                      options: $object.get($state.units, "length")
                      optionLabel: "name"
                      optionValue: "id"
                      onChange: "setToUnit"
                      style:
                        flex: 1

      - Divider: {}

      # Quick conversions
      - Column:
          style:
            gap: 12
          children:
            - Text:
                value: "Quick Conversions"
                style:
                  fontSize: 16
                  fontWeight: "medium"
                  color: "#666"
            - Column:
                style:
                  gap: 8
                children:
                  - Row:
                      style:
                        justifyContent: "space-between"
                        padding: 12
                        backgroundColor: "#f9f9f9"
                        borderRadius: 6
                      children:
                        - Text:
                            value: "1 meter"
                            style:
                              fontSize: 14
                        - Text:
                            value: "3.28 feet"
                            style:
                              fontSize: 14
                              fontWeight: "medium"
                  - Row:
                      style:
                        justifyContent: "space-between"
                        padding: 12
                        backgroundColor: "#f9f9f9"
                        borderRadius: 6
                      children:
                        - Text:
                            value: "1 kilometer"
                            style:
                              fontSize: 14
                        - Text:
                            value: "0.62 miles"
                            style:
                              fontSize: 14
                              fontWeight: "medium"
                  - Row:
                      style:
                        justifyContent: "space-between"
                        padding: 12
                        backgroundColor: "#f9f9f9"
                        borderRadius: 6
                      children:
                        - Text:
                            value: "1 inch"
                            style:
                              fontSize: 14
                        - Text:
                            value: "2.54 centimeters"
                            style:
                              fontSize: 14
                              fontWeight: "medium"
